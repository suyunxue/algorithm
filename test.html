<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>test</title>
	<style >
	</style>
</head>
<body>

	<div>
		<div>
			<span></span>
		</div>
	</div>

	<div id="test">
		<b>hello</b>, Im a ninja!
	</div>

	<div id="test2"></div>


	<div>
		<div>
			<span></span>
		</div>
	</div>


	<script>
	//自下而上的选择器引擎
	window.onload = function () {
		function find(selector, root) {
			root = root || document;

			var parts = selector.split(' ');
			var query = parts[parts.length - 1];
			var rest = parts.slice(0, -1).join('');
			var elems = root.getElementsByTagName(query);
			var results = [];

			for (var i = 0; i < elems.length; i++) {
				if (rest) {
					var parent = elems[i].parentNode;
					while(parent && parent.nodeName != rest) {
						parent = parent.parentNode;
					}

					if (parent) {
						results.push(elems[i]);
					}
				} else {
					results.push(elems[i]);
				}
			}

			return results;

		}
	}





	//查找元素引擎分为几个部分： 解析选择器、查找元素、过滤结果集、递归合并结果

	var selector = 'div.class > span:not(:first-child) a[href]';

	var chunker = /((?:\([^\)]+\)|\[[^\]]+\]|[^,\(\[]+)+)(\s*,\s*)?/g;

	var parts = [];

	chunker.lastIndex = 0;   //重置chunker正则的开始位置

	while ((m = chunker.exec(selector)) !== null) {  //收集分解的内容
		parts.push(m[1]);

		if(m[2]) {
			extra = RegExp.rightContext; //遇到逗号停止
			break;
		}

	}




	//js自己实现一个从上而下的选择器
	window.onload = function () {
		function find(selector, root) {
			//分割选择器，一个一个查找
			root = root || document;

			var parts = selector.split(' ');
			var query = parts[0];
			var rest = parts.slice(1).join(' ');
			var elems = root.getElementsByTagName(query);
			var results = [];

			for (var i = 0; i < elems.length; i++) {
				if (rest) {
					results = results.concat(query, find(rest, elems[i]));
				} else {
					results.push(elems[i]);
				}

			}

			return  results;
		}
	}





	</script>
</body>
</html>
